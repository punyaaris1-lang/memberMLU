<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Member Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* CSS PREMIUM STYLE */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Open Sans', sans-serif; }
        body { background-color: #f5f6fa; color: #333; padding-bottom: 80px; }

        /* Login Page */
        #login-page {
            height: 100vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center; background: white; padding: 20px;
        }
        .login-box input { padding: 15px; width: 100%; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; font-size: 16px; }
        .login-box button { padding: 15px; width: 100%; background: #00a8e8; color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.3s; }
        .login-box button:hover { background: #008eb3; }

        /* Dashboard Page */
        #dashboard-page { display: none; padding: 20px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .greeting h1 { font-size: 18px; color: #008eb3; font-weight: 700; }
        .greeting p { font-size: 24px; font-weight: 800; text-transform: uppercase; margin-top: 5px;}
        .notif-icon { background: #00a8e8; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; }
        
        /* Kartu Utama */
        .main-card {
            background: linear-gradient(135deg, #00a8e8 0%, #0077b6 100%);
            border-radius: 20px; padding: 25px; color: white; margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0, 168, 232, 0.3);
        }
        .card-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; }
        .motor-name { font-size: 18px; font-weight: 700; }
        .status-label { font-size: 12px; opacity: 0.8; }
        .price { font-size: 22px; font-weight: 800; }
        .card-bottom { display: flex; justify-content: space-between; align-items: center; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 15px; }
        .plat-nomor { font-family: monospace; font-size: 16px; letter-spacing: 1px; }

        /* Kartu Info Putih */
        .info-card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .tenor-info { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .tenor-box { display: flex; align-items: center; gap: 10px; }
        .icon-box { width: 40px; height: 40px; background: #e3f2fd; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #00a8e8; }
        .tenor-text h3 { font-size: 18px; color: #00a8e8; font-weight: 800; }
        .tenor-text span { font-size: 12px; color: #888; }
        
        .bill-card { background: #e1f5fe; border-radius: 15px; padding: 20px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .bill-info h4 { font-size: 12px; color: #008eb3; margin-bottom: 5px; }
        .bill-info .bill-amount { font-size: 20px; font-weight: 800; color: #0277bd; }
        .btn-pay { background: #00a8e8; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; }

        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; text-align: center; }
        .menu-item i { font-size: 20px; color: white; }
        .icon-circle { width: 50px; height: 50px; background: #00a8e8; border-radius: 15px; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; }
        .menu-item span { font-size: 12px; color: #555; font-weight: 600; }

        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white;
            display: flex; justify-content: space-around; padding: 15px 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05); border-top-left-radius: 20px; border-top-right-radius: 20px; z-index: 99;
        }
        .nav-item { text-align: center; color: #aaa; text-decoration: none; font-size: 10px; }
        .nav-item i { font-size: 20px; margin-bottom: 5px; display: block; }
        .nav-item.active { color: #00a8e8; }
        .qr-btn {
            background: #00a8e8; width: 55px; height: 55px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; margin-top: -35px; box-shadow: 0 10px 20px rgba(0, 168, 232, 0.4); border: 5px solid white;
        }
    </style>
</head>
<body>

    <div id="login-page">
        <h2 style="margin-bottom: 20px; color: #00a8e8;">MEMBER ACCESS</h2>
        <div class="login-box">
            <input type="tel" id="inputHP" placeholder="Nomor HP (Contoh: 856xxx)" autocomplete="off">
            <button onclick="cekLogin()" id="btnLogin">MASUK</button>
            <p id="status-msg" style="color: #666; font-size: 12px; margin-top: 10px; text-align: center;"></p>
        </div>
    </div>

    <div id="dashboard-page">
        <div class="header">
            <div class="greeting">
                <h1>Selamat Datang,</h1>
                <p id="disp-nama">Loading...</p>
            </div>
            <div class="notif-icon"><i class="fas fa-bell"></i></div>
        </div>

        <div class="main-card">
            <div class="card-top">
                <div>
                    <div class="status-label">Kendaraan</div>
                    <div class="motor-name" id="disp-motor">...</div>
                </div>
                <div class="price">Rp 70.000</div>
            </div>
            <div class="card-bottom">
                <div class="plat-nomor"><i class="far fa-id-card"></i> <span id="disp-plat">...</span></div>
                <div style="font-size: 12px;"><i class="fas fa-cogs"></i> Automatic</div>
            </div>
        </div>

        <div class="info-card">
            <div class="tenor-info">
                <div class="tenor-box">
                    <div class="icon-box"><i class="far fa-calendar-alt"></i></div>
                    <div class="tenor-text">
                        <h3 id="disp-tenor">0</h3>
                        <span>Total tenor</span>
                    </div>
                </div>
                <div class="tenor-box">
                    <div class="icon-box" style="background: #fff3e0; color: #ff9800;"><i class="far fa-clock"></i></div>
                    <div class="tenor-text">
                        <h3 style="color: #ff9800;">Aktif</h3>
                        <span>Status</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="bill-card">
            <div class="bill-info">
                <h4>Tagihan Saat Ini</h4>
                <div class="bill-amount" id="disp-tagihan">Rp 0</div>
            </div>
            <button class="btn-pay">Bayar Sekarang</button>
        </div>

        <div class="menu-grid">
            <div class="menu-item"><div class="icon-circle"><i class="far fa-credit-card"></i></div><span>Tagihan</span></div>
            <div class="menu-item"><div class="icon-circle"><i class="far fa-calendar-check"></i></div><span>Riwayat</span></div>
            <div class="menu-item"><div class="icon-circle"><i class="fas fa-wifi"></i></div><span>SOS</span></div>
            <div class="menu-item"><div class="icon-circle"><i class="fas fa-certificate"></i></div><span>RTO</span></div>
        </div>
    </div>

    <div class="bottom-nav" id="bottomNav" style="display: none;">
        <a href="#" class="nav-item active"><i class="fas fa-home"></i>Home</a>
        <a href="#" class="nav-item"><i class="far fa-credit-card"></i>Tagihan</a>
        <a href="#" class="qr-btn"><i class="fas fa-qrcode"></i></a>
        <a href="#" class="nav-item"><i class="far fa-calendar-alt"></i>Riwayat</a>
        <a href="#" class="nav-item"><i class="far fa-user"></i>Profile</a>
    </div>

    <script>
        // --- KONFIGURASI DATABASE ---
        const googleSheetLink = 'https://docs.google.com/spreadsheets/d/1ERgIFLVIS1SRHrXi2clXiU8oj0gtLT4XZUzO1sy_P1Q/edit?usp=drivesdk'; 

        // Fungsi Pembersih Nomor HP (Jantung dari sistem ini)
        function cleanPhone(phone) {
            let p = String(phone).trim();
            // Buang karakter selain angka (biar aman dari spasi/-)
            p = p.replace(/[^0-9]/g, '');
            // Jika diawali 62, buang 62
            if (p.startsWith('62')) {
                p = p.substring(2);
            }
            // Jika diawali 0, buang 0
            if (p.startsWith('0')) {
                p = p.substring(1);
            }
            return p;
        }

        function cekLogin() {
            var hpInput = document.getElementById("inputHP").value;
            const btn = document.getElementById("btnLogin");
            const msg = document.getElementById("status-msg");

            if(!hpInput) {
                msg.innerText = "Masukkan nomor HP dulu!";
                msg.style.color = "red";
                return;
            }

            // Bersihkan Input User (Jadi kalau user iseng ngetik 08xxx, tetap kita proses 8xxx)
            const cleanInput = cleanPhone(hpInput);

            // UI Loading
            btn.innerHTML = "MEMERIKSA...";
            btn.disabled = true;
            msg.innerText = "Mencari data di server...";
            msg.style.color = "blue";

            const sheetID = getSheetID(googleSheetLink);
            
            fetch(`https://opensheet.elk.sh/${sheetID}/Sheet1`)
            .then(res => res.json())
            .then(data => {
                // LOGIKA PENCARIAN CERDAS (SMART MATCH)
                const user = data.find(row => {
                    // Kita bersihkan juga nomor yang ada di Database
                    // Jadi mau di database tulisannya 08xxx atau 628xxx, kita ubah jadi 8xxx
                    const dbHP = cleanPhone(row['No HP']);
                    return dbHP === cleanInput;
                });

                if (user) {
                    // KETEMU!
                    document.getElementById("disp-nama").innerText = user['Nama'] || "Member";
                    document.getElementById("disp-motor").innerText = user['Motor'] || "-";
                    document.getElementById("disp-plat").innerText = user['Plat Nomor'] || "B xxxx";
                    document.getElementById("disp-tenor").innerText = (user['Tenor Hari'] || "0") + " Hari";
                    document.getElementById("disp-tagihan").innerText = user['Tagihan'] || "Lunas";

                    document.getElementById("login-page").style.display = "none";
                    document.getElementById("dashboard-page").style.display = "block";
                    document.getElementById("bottomNav").style.display = "flex";
                } else {
                    // GAGAL
                    msg.innerText = "Nomor tidak terdaftar!";
                    msg.style.color = "red";
                    
                    // Alert Debugging (Opsional: Kalau mau tau input yg dibaca apa)
                    // alert("Input bersih: " + cleanInput);

                    btn.innerHTML = "MASUK";
                    btn.disabled = false;
                }
            })
            .catch(err => {
                console.error(err);
                msg.innerText = "Gagal koneksi. Cek internet/Sheet.";
                msg.style.color = "red";
                btn.innerHTML = "MASUK";
                btn.disabled = false;
            });
        }

        function getSheetID(url) {
            const matches = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
            return matches ? matches[1] : null;
        }
    </script>

</body>
</html>
